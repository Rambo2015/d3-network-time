!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("d3-force"),require("d3-selection"),require("d3-scale"),require("d3-array"),require("d3-collection"),require("d3-time-format")):"function"==typeof define&&define.amd?define(["exports","d3-force","d3-selection","d3-scale","d3-array","d3-collection","d3-time-format"],r):(t=t||self,r(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3))}(this,function(t,r,e,n,i,o,a){"use strict";function u(){return u=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},u.apply(this,arguments)}function c(t){var r,e,n,i,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t.target.x-t.source.x,u=t.target.y-t.source.y,c=Math.atan2(u,a);return o?(r=t.source.x+Math.cos(c)*t.source.r,e=t.source.y+Math.sin(c)*t.source.r,n=t.target.x-Math.cos(c)*t.target.r,i=t.target.y-Math.sin(c)*t.target.r):(r=t.source.x,e=t.source.y,n=t.target.x-Math.cos(c)*t.target.r,i=t.target.y-Math.sin(c)*t.target.r),"M"+r+","+e+"L"+((n-r)/2+r)+","+((i-e)/2+e)+"L"+n+","+i}function l(t){var r=o.nest().key(function(t){return t.date}).rollup(function(t){return t.length}).entries(t);return r.forEach(function(t){t.key=w(t.key)}),r}function s(t){function a(a){function A(r,n,i){function o(t){return t.id}function a(t){return t.source.id+"-"+t.target.id}function u(t){t.each(function(t){t.bbox=this.getBBox()})}function l(t){d(_,E,t,{hover_textOpacity:0,hover_strokeOpacity:.2,hover_arrow:"url(#arrowhead)"})}function s(){f(_,E)}function d(t,r,e,n){function i(t,r){return F["".concat(t.id,",").concat(r.id)]||F["".concat(r.id,",").concat(t.id)]||t.id===r.id}function o(t,r){return"Unknown"===t.root_id|"Unlinked"===t.root_id?i(t,r)|r.root_id===t.id:i(t,r)}var a=n.hover_textOpacity,u=n.hover_strokeOpacity,c=n.hover_arrow;t.selectAll(".node").attr("opacity",function(t){return o(e,t)?1:u}).style("pointer-events",function(t){return o(e,t)?"auto":"none"}),t.selectAll(".root-label").attr("opacity",function(t){return o(e,t)?1:a}),t.selectAll(".node-label").attr("opacity",function(t){return o(e,t)?1:a}),r.selectAll(".link").attr("opacity",function(t){return t.source===e||t.target===e?1:u}).attr("marker-mid",function(t){return t.source===e||t.target===e?"url(#arrowheadOpaque)":c}),r.selectAll(".edge-label").attr("opacity",function(t){return t.source===e||t.target===e?.5:a})}function f(t,r){t.selectAll(".node").attr("opacity",p).style("pointer-events","auto"),t.selectAll(".root-label").attr("opacity",1),t.selectAll(".node-label").attr("opacity",q),r.selectAll(".link").attr("opacity",1),r.selectAll(".edge-label").attr("opacity",C)}var y=i.root,x=i.rootparent,k=i.berects,w=e.select(t).select(".nodes"),O=e.select(t).select(".links"),_=w.selectAll("g").data(r,function(t){return o(t)});_.exit().select("circle").transition().duration(b).attr("r",0).remove(),_.exit().select("rect").transition().duration(b).attr("width",0).attr("height",0).remove(),_.exit().select("text").remove(),_.exit().transition().duration(b).remove();var A=_.enter().append("g").attr("id",function(t){return"node-group-"+o(t)});A.attr("transform",function(t){return k(t)?"parent"===t.type?"translate("+(t.x0-t.radius+t.strokeWidth)+","+(t.y0-t.radius+t.strokeWidth)+")":"translate("+(t.x0-t.radius)+","+(t.y0-t.radius)+")":"translate("+t.x0+","+t.y0+")"}),A.filter(function(t){return!k(t)}).append("circle").attr("class","node node-circle").attr("id",function(t){return"node-"+t.id}).attr("stroke-width",function(t){return t.strokeWidth}).attr("stroke",function(t){return t.strokeColor}).attr("opacity",function(t){return t.opacity}).attr("fill",function(t){return t.color}),A.filter(function(t){return k(t)}).append("rect").attr("class","node node-rect").attr("id",function(t){return"node-"+t.id}).attr("stroke-width",function(t){return t.strokeWidth}).attr("stroke",function(){return Y.nodeStroke}).attr("opacity",function(t){return t.opacity}).attr("fill",function(t){return t.color}),A.filter(function(t){return!y(t)}).append("text").attr("class","node-label").attr("font-size","".concat(g,"px")).attr("text-anchor","middle").attr("fill",Y.nodeTextFill).attr("opacity",h).attr("x",function(t){return k(t)?t.radius:0}).attr("y",function(t){return k(t)?-10:-t.radius-8}).text(function(t){return"".concat(t.id)});var T=A.filter(function(t){return y(t)});T.append("text").attr("class","root-label").attr("font-size","".concat(2*g,"px")).attr("text-anchor","middle").attr("fill",Y.nodeTextFill).attr("opacity",1).attr("x",function(t){return k(t)?t.radius:0}).attr("y",function(t){return k(t)?-10:-t.radius-10}).text(function(t){return"".concat(t.id)}).call(u),T.insert("rect","text").attr("x",function(t){return k(t)?t.radius+t.bbox.x:0+t.bbox.x}).attr("y",function(t){return k(t)?-25:-t.radius-10-15}).attr("width",function(t){return t.bbox.width}).attr("height",function(t){return t.bbox.height}).style("fill",Y.nodeFill).style("opacity",.8),_=A.merge(_),_.transition().duration(b).attr("transform",function(t){return k(t)?"translate("+(t.x-t.radius)+","+(t.y-t.radius)+")":"translate("+t.x+","+t.y+")"}),_.selectAll(".node-circle").call(function(t){t.transition().attr("r",function(t){return t.radius}).attr("fill",function(t){return t.color}).attr("stroke",function(t){return t.strokeColor})}),_.selectAll(".node-rect").call(function(t){t.transition().attr("width",function(t){return 2*t.radius}).attr("height",function(t){return 2*t.radius}).attr("fill",function(t){return t.color}).attr("stroke",function(t){return t.strokeColor})}),_.selectAll(".nodeFO").call(function(t){t.transition().attr("x",0).attr("y",0).attr("width",function(t){return 2*t.radius-t.strokeWidth}).attr("height",function(t){return 2*t.radius-t.strokeWidth}).attr("transform",function(t){return"translate("+-t.radius+","+-t.radius+")"})}),_.selectAll(".node").on("mouseover.fade",function(t){return l(t)}).on("mouseout.fade",function(){return s()}),_.selectAll(".node").filter(function(t){return x(t)});var E=O.selectAll("g").data(n,function(t){return a(t)});E.exit().select("path").transition().duration(b).attr("d",function(t){return c({source:{x:t.source.x,y:t.source.y,r:0},target:{x:t.source.x,y:t.source.y,r:0}},"root"!==t.source.type)}).attr("opacity",0).remove(),E.exit().transition().duration(b).remove();var M=E.enter().append("g").attr("id",function(t){return"path-group-"+a(t)});M.append("path").attr("class","link").attr("id",function(t){return"path-"+a(t)}).attr("marker-mid","url(#arrowhead)").attr("stroke-width",function(t){return t.strokeWidth}).attr("stroke",function(t){return t.strokeColor}).attr("opacity",function(t){return t.opacity}).attr("d",function(t){return c({source:{x:t.source.x0,y:t.source.y0,r:t.source.radius},target:{x:t.target.x0,y:t.target.y0,r:t.target.radius}},"root"!==t.source.type)}),M.append("text").attr("class","edge-label").attr("font-size","".concat(m,"px")).attr("text-anchor","middle").attr("fill",Y.linkTextFill).attr("opacity",v).attr("dy",-2).append("textPath").attr("xlink:href",function(t){return"#path-"+a(t)}).attr("startOffset","50%").text(function(t){return"".concat(t.label)}),E=M.merge(E),E.selectAll(".link").transition().duration(b).attr("opacity",function(t){return t.opacity}).attr("d",function(t){return c({source:{x:t.source.x,y:t.source.y,r:t.source.radius},target:{x:t.target.x,y:t.target.y,r:t.target.radius}},"root"!==t.source.type)})}function E(t,r){function e(t){return l(t)?"root":s(t)?"parent":h(t)?"children":void 0}var a=t.filter(function(t){return void 0!==t.root}).map(function(t){return t.id}),u=[],c=[];t.map(function(t){0===r.filter(function(r){return r.start_id===t.id}).map(function(t){return t.end_id}).length?c.push(t.id):-1===a.indexOf(t.id)&&u.push(t.id)});var l=function(t){return-1!==a.indexOf(t.id)},s=function(t){return-1!==u.indexOf(t.id)},d=function(t){return-1!==u.concat(a).indexOf(t.id)},h=function(t){return-1!==c.indexOf(t.id)},g=function(){},v={root:l,parent:s,child:h,rootparent:d,berects:g},m=o.nest().key(function(t){return t.end_id}).rollup(function(t){return t.length}).entries(r),b=o.nest().key(function(t){return t.start_id}).rollup(function(t){return t.length}).entries(r),w=[];m.map(function(t){w.push({key:t.key,value:t.value})}),b.map(function(t){w.push({key:t.key,value:t.value})});var O=o.nest().key(function(t){return t.key}).rollup(function(t){return i.sum(t,function(t){return t.value})}).entries(w),_=n.scaleLinear().domain(i.extent(O,function(t){return t.value})).range([.4,.3]),A=n.scaleOrdinal().domain(["root","parent","child"]).range([150,40,30]);return t.forEach(function(t){t.strokeWidth=y,t.opacity=p}),r.forEach(function(t){t.strokeColor=Y.linkStroke,t.strokeWidth=x,t.opacity=k}),t.forEach(function(t){t.type=e(t)}),r.forEach(function(r){r.type=t.find(function(t){return t.id===r.start_id}).type}),t.forEach(function(t){var r=O.find(function(r){return r.key===t.id});t.radius=l(t)?f:r?W.scale(r.value):4,t.color=d(t)?Y.nodeFill:M(t),t.strokeColor=l(t)?Y.nodeStroke:M(t)}),r.forEach(function(t){var r=O.find(function(r){return r.key===t.end_id}).value;t.strength=_(r),t.distance=A(t.type)}),{nodes:t,links:r,accessors:v}}function j(t,e){S.stop();var n=e.nodes,i=e.links,o=e.date,a=t.nodes.filter(function(t){return w(t.date).getTime()>o.getTime()}),u=t.links.filter(function(t){return w(t.date).getTime()>o.getTime()});n=t.nodes.filter(function(t){return-1==a.map(function(t){return t.id}).indexOf(t.id)}),i=t.links.filter(function(t){return-1==u.map(function(t){return t.id}).indexOf(t.id)}),console.log(n,i);var c=n.map(function(t){return t.id});i=i.filter(function(t){return-1!==c.indexOf(t.start_id)}),i=i.filter(function(t){return-1!==c.indexOf(t.end_id)});var l=E(n,i);n=l.nodes,i=l.links,i.forEach(function(t){t.source=n.find(function(r){return r.id===t.start_id}),t.target=n.find(function(r){return r.id===t.end_id})}),i.forEach(function(t){F["".concat(t.source.id,",").concat(t.target.id)]=1}),n.forEach(function(t){var r={x:I.width/2,y:I.height/2};t.x=t.x?t.x:r.x,t.y=t.y?t.y:r.y,t.fx="root"==t.type?r.x:void 0,t.fy="root"==t.type?r.y:void 0,t.x0=t.x,t.y0=t.y});var s=r.forceManyBody().strength(-30),d=r.forceCollide(function(t){return 2*t.radius});S.force("charge",s).force("collide",d).force("center",r.forceCenter(I.width/2,I.height/2)),S.nodes(n),S.force("link").links(i),S.alpha(.3).restart();for(var f=0;f<300;++f)S.tick();return n.forEach(function(t){t.x0=t.x,t.y0=t.y}),A(n,i,l.accessors),{nodes:n,links:i}}var I={width:s,height:d};if(t=t||"body",null!==e.select(t).select("svg")){var L=e.select(t).append("svg").attr("class","networkWrapper").attr("width",I.width).attr("height",I.height).attr("fill",P.secondary),z=L.append("g").attr("class","network");z.append("g").attr("class","links"),z.append("g").attr("class","nodes")}var B=l(a.links);_=_||B[0].key,T=T||B[B.length-1].key;var R="string"==typeof _?w(_):_,U="string"==typeof T?w(T):T;a.date=R;var N=u({},a);if(null===O)j(a,N);else if("auto"===O){var D,G,H={playing:!0,status:"play",initial:!0},J=B.map(function(t){return t.key.getTime()});if(J=J.filter(function(t){return t>=R.getTime()&t<=U.getTime()}),G=H.initial?0:J.indexOf(N.date.getTime()),H.playing&&(D=setInterval(function(){N.date=B[G].key;var t=j(a,N);N.nodes=t.nodes,N.links=t.links,++G>J.length-1&&(clearInterval(D),H={playing:!1,status:"end",initial:!0})},1e3)),!1===H.playing&"pause"===H.status){clearInterval(D),N.date=B[G].key;var K=j(a,N);N.nodes=K.nodes,N.links=K.links}if(!1===H.playing&"end"===H.status){clearInterval(D),N.date=B[J.length-1].key;var Q=j(a,N);N.nodes=Q.nodes,N.links=Q.links}}else if("step"===O){var V=j(a,N);setTimeout(function(){N.date=U,N.nodes=V.nodes,N.links=V.links,j(a,N)},1e3)}}var s=800,d=800,O=null,_="",T="",F=[],E=A,M=E.colorAccessor,W=E.nodeRadius,q=h,C=v,S=r.forceSimulation().force("link",r.forceLink().distance(function(t){return t.distance}).strength(function(t){return t.strength})),P={type:"light",primary:"#f5f5f5",secondary:"#333333"},Y={nodeFill:P.primary,nodeStroke:P.secondary,nodeTextFill:P.secondary,linkStroke:P.secondary,linkTextFill:P.secondary};return a.selector=function(r){return arguments.length?(t=r,a):t},a.width=function(t){return arguments.length?(s=t,a):s},a.height=function(t){return arguments.length?(d=t,a):d},a.start=function(t){return arguments.length?(_=t,a):_},a.end=function(t){return arguments.length?(T=t,a):T},a.style=function(t){return arguments.length?(O=t,a):O},a}function d(){return 42}var f=30,y=2,p=1,h=.8,g=12,x=2,k=1,v=0,m=8,b=750,w=(a.timeFormat("%Y"),a.timeFormat("%d %b %Y"),a.timeFormat("%d/%m/%y"),a.timeParse("%Y-%m-%d")),O=(a.timeParse("%Y"),a.timeParse("%b %Y"),w("2020-05-11"),n.scaleSqrt().domain([1,50]).range([10,50])),_=n.scaleOrdinal().range(["white","aqua","fuchsia"]).domain(["root","parent","children"]),A={colorAccessor:function(t){return _(t.type)},nodeRadius:{label:"Number of records",domain:[1,15,50],scale:O}};t.network=s,t.timeline=d,Object.defineProperty(t,"__esModule",{value:!0})});