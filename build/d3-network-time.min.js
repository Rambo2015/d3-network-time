!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-force"),require("d3-selection"),require("d3-transition"),require("d3-scale")):"function"==typeof define&&define.amd?define(["exports","d3-force","d3-selection","d3-transition","d3-scale"],e):(t=t||self,e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3))}(this,function(t,e,r,n,o){"use strict";function i(){return i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},i.apply(this,arguments)}function a(t){var e,r,n,o,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t.target.x-t.source.x,c=t.target.y-t.source.y,u=Math.atan2(c,a);return i?(e=t.source.x+Math.cos(u)*t.source.r,r=t.source.y+Math.sin(u)*t.source.r,n=t.target.x-Math.cos(u)*t.target.r,o=t.target.y-Math.sin(u)*t.target.r):(e=t.source.x,r=t.source.y,n=t.target.x-Math.cos(u)*t.target.r,o=t.target.y-Math.sin(u)*t.target.r),"M"+e+","+r+"L"+((n-e)/2+e)+","+((o-r)/2+r)+"L"+n+","+o}function c(t,e){return"year"===e?t.addYears(1):"month"===e?t.addMonths(1):"day"===e?t.addDays(1):"week"===e?t.addWeeks(1):"hour"===e?t.addHours(1):"minute"===e?t.addMinutes(1):"second"===e?t.addSeconds(1):"millisecond"===e?t.addMilliseconds(1):void 0}function u(t,e,r){t=new Date(1e3*t),e=new Date(1e3*e);for(var n=new Array,o=t;o<=e;)n.push(o),o=c(o,r);return n}function s(t){function n(n){function h(t,e,n){function o(t){return t.id}function i(t){return t.source.id+"-"+t.target.id}function c(t){t.each(function(t){t.bbox=this.getBBox()})}function u(t){d(m,D,t,{hover_textOpacity:0,hover_strokeOpacity:.2})}function s(){l(m,D)}function d(t,e,r,n){function o(t,e){return y["".concat(t.id,",").concat(e.id)]||y["".concat(e.id,",").concat(t.id)]||t.id===e.id}var i=n.hover_textOpacity,a=n.hover_strokeOpacity;t.selectAll(".node").attr("opacity",function(t){return o(r,t)?1:a}).style("pointer-events",function(t){return o(r,t)?"auto":"none"}),t.selectAll(".root-label").attr("opacity",function(t){return o(r,t)?1:i}),t.selectAll(".node-label").attr("opacity",function(t){return o(r,t)?1:i}),e.selectAll(".link").attr("opacity",function(t){return t.source===r||t.target===r?1:a}),e.selectAll(".edge-label").attr("opacity",function(t){return t.source===r||t.target===r?.5:i})}function l(t,e){t.selectAll(".node").attr("opacity",k.nodeOpacity).style("pointer-events","auto"),t.selectAll(".root-label").attr("opacity",1),t.selectAll(".node-label").attr("opacity",k.nodeTextOpacity),e.selectAll(".link").attr("opacity",1),e.selectAll(".edge-label").attr("opacity",k.linkTextOpacity)}var f=n.root,h=n.rootparent,x=n.berects,g=r.select(p).select(".nodes"),v=r.select(p).select(".links"),m=g.selectAll("g").data(t,function(t){return o(t)});m.exit().select("circle").transition().duration(k.transitionDuration).attr("r",0).remove(),m.exit().select("rect").transition().duration(k.transitionDuration).attr("width",0).attr("height",0).remove(),m.exit().select("text").remove(),m.exit().transition().duration(k.transitionDuration).remove();var O=m.enter().append("g").attr("id",function(t){return"node-group-"+o(t)});O.attr("transform",function(t){return x(t)?"parent"===t.type?"translate("+(t.x0-t.radius+t.strokeWidth)+","+(t.y0-t.radius+t.strokeWidth)+")":"translate("+(t.x0-t.radius)+","+(t.y0-t.radius)+")":"translate("+t.x0+","+t.y0+")"}),O.filter(function(t){return!x(t)}).append("circle").attr("class","node node-circle").attr("id",function(t){return"node-"+t.id}).attr("stroke-width",function(t){return t.strokeWidth}).attr("stroke",function(t){return t.strokeColor}).attr("opacity",function(t){return t.opacity}).attr("fill",function(t){return t.color}),O.filter(function(t){return x(t)}).append("rect").attr("class","node node-rect").attr("id",function(t){return"node-"+t.id}).attr("stroke-width",function(t){return t.strokeWidth}).attr("stroke",function(t){return t.strokeColor}).attr("opacity",function(t){return t.opacity}).attr("fill",function(t){return t.color}),O.filter(function(t){return!f(t)}).append("text").attr("class","node-label").attr("font-size","".concat(k.nodeTextSize,"px")).attr("text-anchor","middle").attr("fill",k.nodeTextFill).attr("opacity",k.nodeTextOpacity).attr("x",function(t){return x(t)?t.radius:0}).attr("y",function(t){return x(t)?-10:-t.radius-8}).text(function(t){return"".concat(t.id)});var A=O.filter(function(t){return f(t)});A.append("text").attr("class","root-label").attr("font-size","".concat(2*k.nodeTextSize,"px")).attr("text-anchor","middle").attr("fill",k.nodeTextFill).attr("opacity",1).attr("x",function(t){return x(t)?t.radius:0}).attr("y",function(t){return x(t)?-10:-t.radius-10}).text(function(t){return"".concat(t.id)}).call(c),A.insert("rect","text").attr("x",function(t){return x(t)?t.radius+t.bbox.x:0+t.bbox.x}).attr("y",function(t){return x(t)?-25:-t.radius-10-15}).attr("width",function(t){return t.bbox.width}).attr("height",function(t){return t.bbox.height}).style("fill",k.nodeFill).style("opacity",.8),m=O.merge(m),m.transition().duration(k.transitionDuration).attr("transform",function(t){return x(t)?"translate("+(t.x-t.radius)+","+(t.y-t.radius)+")":"translate("+t.x+","+t.y+")"}),m.selectAll(".node-circle").call(function(t){t.transition().attr("r",function(t){return t.radius}).attr("fill",function(t){return t.color}).attr("stroke",function(t){return t.strokeColor})}),m.selectAll(".node-rect").call(function(t){t.transition().attr("width",function(t){return 2*t.radius}).attr("height",function(t){return 2*t.radius}).attr("fill",function(t){return t.color}).attr("stroke",function(t){return t.strokeColor})}),m.selectAll(".nodeFO").call(function(t){t.transition().attr("x",0).attr("y",0).attr("width",function(t){return 2*t.radius-t.strokeWidth}).attr("height",function(t){return 2*t.radius-t.strokeWidth}).attr("transform",function(t){return"translate("+-t.radius+","+-t.radius+")"})}),m.selectAll(".node").on("mouseover.fade",function(t){return u(t)}).on("mouseout.fade",function(){return s()}),m.selectAll(".node").filter(function(t){return h(t)});var D=v.selectAll("g").data(e,function(t){return i(t)});D.exit().select("path").transition().duration(k.transitionDuration).attr("d",function(t){return a({source:{x:t.source.x,y:t.source.y,r:0},target:{x:t.source.x,y:t.source.y,r:0}},"root"!==t.source.type)}).attr("opacity",0).remove(),D.exit().transition().duration(k.transitionDuration).remove();var w=D.enter().append("g").attr("id",function(t){return"path-group-"+i(t)});w.append("path").attr("class","link").attr("id",function(t){return"path-"+i(t)}).attr("stroke-width",function(t){return t.strokeWidth}).attr("stroke",function(t){return t.strokeColor}).attr("opacity",function(t){return t.opacity}).attr("d",function(t){return a({source:{x:t.source.x0,y:t.source.y0,r:t.source.radius},target:{x:t.target.x0,y:t.target.y0,r:t.target.radius}},"root"!==t.source.type)}),w.append("text").attr("class","edge-label").attr("font-size","".concat(k.linkTextSize,"px")).attr("text-anchor","middle").attr("fill",k.linkTextFill).attr("opacity",k.linkTextOpacity).attr("dy",-2).append("textPath").attr("xlink:href",function(t){return"#path-"+i(t)}).attr("startOffset","50%").text(function(t){return"".concat(t.label)}),D=w.merge(D),D.selectAll(".link").transition().duration(k.transitionDuration).attr("opacity",function(t){return t.opacity}).attr("d",function(t){return a({source:{x:t.source.x,y:t.source.y,r:t.source.radius},target:{x:t.target.x,y:t.target.y,r:t.target.radius}},"root"!==t.source.type)})}function x(t,e){function r(t){return a(t)?"root":c(t)?"parent":s(t)?"children":void 0}var n=t.filter(function(t){return void 0!==t.root}).map(function(t){return t.id}),o=[],i=[];t.map(function(t){0===e.filter(function(e){return e.start_id===t.id}).map(function(t){return t.end_id}).length?i.push(t.id):-1===n.indexOf(t.id)&&o.push(t.id)});var a=function(t){return-1!==n.indexOf(t.id)},c=function(t){return-1!==o.indexOf(t.id)},u=function(t){return-1!==o.concat(n).indexOf(t.id)},s=function(t){return-1!==i.indexOf(t.id)},d=function(){},l={root:a,parent:c,child:s,rootparent:u,berects:d};return t.forEach(function(t){t.type=r(t)}),e.forEach(function(e){e.type=t.find(function(t){return t.id===e.start_id}).type}),t.forEach(function(t){t.radius=k.radiusAccessor(t),t.color=k.nodeColorAccessor(t),t.strokeColor=k.nodeColorAccessor(t),t.opacity=k.nodeOpacityAccessor(t),t.strokeWidth=k.nodeStrokeWidth}),e.forEach(function(t){t.strokeColor=k.linkColorAccessor(t),t.strokeWidth=k.linkWidthAccessor(t),t.opacity=k.linkOpacityAccessor(t),t.strength=k.strengthAccessor(t)}),{nodes:t,links:e,accessors:l}}function g(e,r){t.stop();var n=r.nodes,o=r.links,i=r.date,a=e.nodes.filter(function(t){return 1e3*t.date>i.getTime()}),c=e.links.filter(function(t){return 1e3*t.date>i.getTime()});n=e.nodes.filter(function(t){return-1==a.map(function(t){return t.id}).indexOf(t.id)}),o=e.links.filter(function(t){return-1==c.map(function(t){return t.id}).indexOf(t.id)});var u=n.map(function(t){return t.id});o=o.filter(function(t){return-1!==u.indexOf(t.start_id)&-1!==u.indexOf(t.end_id)});var s=x(n,o);n=s.nodes,o=s.links,o.forEach(function(t){t.source=n.find(function(e){return e.id===t.start_id}),t.target=n.find(function(e){return e.id===t.end_id})}),o.forEach(function(t){y["".concat(t.source.id,",").concat(t.target.id)]=1}),n.forEach(function(t){var e={x:w.width/2,y:w.height/2};t.x=t.x?t.x:e.x,t.y=t.y?t.y:e.y,t.fx="root"==t.type?e.x:void 0,t.fy="root"==t.type?e.y:void 0,t.x0=t.x,t.y0=t.y}),t.nodes(n),t.force("link").links(o),t.alpha(.3).restart();for(var d=0;d<300;++d)t.tick();return n.forEach(function(t){t.x0=t.x,t.y0=t.y}),h(n,o,s.accessors),{nodes:n,links:o}}var v=i({},n),k=s,m=d,O=m.mode,A=m.step,D=m.show_time,w={width:o,height:c};t=t||e.forceSimulation();var b=u(l,f,A),M=b[0],T=b[b.length-1];v.date=M;var W=i({},v);if(r.select(p).select("svg").empty()){!0===D&&r.select(p).append("h1").attr("class","timeHeader");var _=r.select(p).append("svg").attr("class","networkWrapper").attr("width",w.width).attr("height",w.height).attr("fill","transparent"),S=_.append("g").attr("class","network");S.append("g").attr("class","links"),S.append("g").attr("class","nodes")}if(null===O)g(v,W);else if("auto"===O){var C,E,F={playing:!0,status:"play",initial:!0},z=b.map(function(t){return t});if(z=z.filter(function(t){return t>=M&t<=T}),E=F.initial?0:z.indexOf(W.date),F.playing&&(C=setInterval(function(){W.date=b[E],r.select(".timeHeader").html(W.date);var t=g(v,W);W.nodes=t.nodes,W.links=t.links,++E>z.length-1&&(clearInterval(C),F={playing:!1,status:"end",initial:!0})},1e3)),!1===F.playing&"pause"===F.status){clearInterval(C),W.date=b[E];var H=g(v,W);W.nodes=H.nodes,W.links=H.links}if(!1===F.playing&"end"===F.status){clearInterval(C),W.date=b[z.length-1];var q=g(v,W);W.nodes=q.nodes,W.links=q.links}}else if("step"===O){var j=g(v,W);setTimeout(function(){W.date=T,W.nodes=j.nodes,W.links=j.links,g(v,W)},1e3)}}var o=800,c=800,s=k,d={mode:null,step:"day",show_time:"false"},l=new Date,f=new Date,p="body",y=[];return n.selector=function(t){return arguments.length?(p=t,n):p},n.width=function(t){return arguments.length?(o=t,n):o},n.height=function(t){return arguments.length?(c=t,n):c},n.start=function(t){return arguments.length?(l=t,n):l},n.end=function(t){return arguments.length?(f=t,n):f},n.style=function(t){return arguments.length?(s=t,n):s},n.animation=function(t){return arguments.length?(d=t,n):d},n}var d=o.scaleSqrt().domain([1,50]).range([3,25]),l=o.scaleOrdinal().range(["#E10100","#00bcd4","#3f51b5"]).domain(["root","parent","children"]),f=function(t){return d(t.value)},p=function(){return 1},y=function(t){return l(t.type)},h=function(){return 2},x=function(){return 1},g=function(){return"gray"},v=function(){return.5},k={nodeStrokeWidth:2,nodeTextOpacity:.8,nodeTextSize:12,nodeTextFill:"gray",linkTextOpacity:0,linkTextSize:8,linkTextFill:"gray",transitionDuration:750,radiusAccessor:f,nodeOpacityAccessor:p,nodeColorAccessor:y,linkWidthAccessor:h,linkOpacityAccessor:x,linkColorAccessor:g,strengthAccessor:v};Date.prototype.addYears=function(t){var e=new Date(this.valueOf());return e.setFullYear(e.getFullYear()+t),e},Date.prototype.addMonths=function(t){var e=new Date(this.valueOf());return e.setMonth(e.getMonth()+t),e},Date.prototype.addDays=function(t){var e=new Date(this.valueOf());return e.setDate(e.getDate()+t),e},Date.prototype.addWeeks=function(t){var e=new Date(this.valueOf());return e.setDate(e.getDate()+7*t),e},Date.prototype.addHours=function(t){var e=new Date(this.valueOf());return e.setHours(e.getHours()+t),e},Date.prototype.addMinutes=function(t){var e=new Date(this.valueOf());return e.setMinutes(e.getMinutes()+t),e},Date.prototype.addSeconds=function(t){var e=new Date(this.valueOf());return e.setSeconds(e.getSeconds()+t),e},Date.prototype.addMilliseconds=function(t){var e=new Date(this.valueOf());return e.setMilliseconds(e.getMilliseconds()+t),e},t.network=s,Object.defineProperty(t,"__esModule",{value:!0})});